<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Charts</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    </head>

    <body>
        <div class="container-fluid">
            <div class="row" style="background-color:rgb(80, 102, 80)">
              <div class="col-lg-5"></div>
      
              <div class="col-lg-2 mb-4">
                <img src="../../imgs/logo.png" class="img-thumbnail mt-4 mx-auto d-block" height="45" width="170">
              </div>
      
              <div class="col-lg-3"></div>
      
              <div class="col-lg-2 mt-4">
                <div class="btn-group">
                  <button type="button" class="btn btn-link">
                    <img src="../../imgs/home.png" class="img-thumbnail" width="45" height="45">
                  </button>
      
                  <button type="button" class="btn btn-link">
                    <img src="../../imgs/user.png" class="img-thumbnail" width="45" height="45">
                  </button>
      
                  <button type="button" class="btn btn-link">
                    <img src="../../imgs/power.png" class="img-thumbnail" width="45" height="45">
                  </button> 
                </div>  
              </div>
            </div>
        </div>


        <div class="container-fluid ms-2 mt-2">
            <div class="row">
                
                <div class="col-lg-3">
                    <form class="border border-3 rounded-4 ps-4 pt-4 mt-4">
                        <p class="h3 text-center mb-4">Toggles</p>

                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="check1" name="option1" value="something">
                            <label class="form-check-label" for="check1">New Requests</label>
                        </div>

                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="check2" name="option2" value="something">
                            <label class="form-check-label" for="check2">Completed Requests</label>
                        </div>

                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="check3" name="option3" value="something">
                            <label class="form-check-label" for="check3">New Offers</label>
                        </div>

                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="check4" name="option4" value="something">
                            <label class="form-check-label" for="check4">Completed Offers</label>
                        </div>
                    </form>


                    <form class="border border-3 rounded-4 ps-4 pt-4 mt-4">
                        <p class="h3 text-center mb-4">Time Period</p>

                        <div class="mb-3">
                            <label for="start_date" class="form-label">Start Date:</label>
                            <input type="date" class="form-control" id="start_date" name="start_date" lang="en">
                        </div>

                        <div class="mb-3">
                            <label for="end_date" class="form-label">End Date:</label>
                            <input type="date" class="form-control" id="end_date" name="end_date" lang="en">
                        </div>

                        <div class="text-center mb-3">
                            <button type="button" class="btn btn-primary" id="display_btn">Display</button>
                        </div>
                    </form>
                </div>

                <div class="col-lg-9 mt-2">
                    <canvas id="chart" style="height: 550px; width: 1000px;"></canvas>
                </div>
            </div>
        </div>
    </body>


    <script>
        document.getElementById('start_date').addEventListener('input', function() {
            document.getElementById('end_date').min = this.value;
        });

        document.getElementById('end_date').addEventListener('input', function() {
            document.getElementById('start_date').max = this.value;
        });

        let chart = new Chart('chart', {
            type: 'line',
            data: {
                labels: [],
                datasets: []
            },
            options: {
                legend: {display: false},
                scales: {
                    yAxes: [{ticks: {min: 0, max:30}}],
                }
            }
        });

        document.getElementById('display_btn').addEventListener('click' , function() {

            document.getElementById('check1').removeEventListener('change', check1);
            document.getElementById('check2').removeEventListener('change', check2);
            document.getElementById('check3').removeEventListener('change', check3);
            document.getElementById('check4').removeEventListener('change', check4);

            chart.data.datasets = [];

            let xValues = [];

            let start_date = new Date(document.getElementById('start_date').value);
            let end_date = new Date(document.getElementById('end_date').value);
            let difference_in_days = (end_date - start_date) / (1000 * 3600 * 24);

            for (let i = 0; i <= difference_in_days; i++) {
                let date = new Date(start_date);
                date.setDate(date.getDate() + i);
                xValues.push(date.toISOString().slice(0, 10));
            }

            chart.data.labels = xValues;
            chart.update();

            if (document.getElementById('check1').checked) {
                fetch('http://localhost:3000/get_tasks/request/new/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                .then(response => response.json())
                .then(data => {
                    let yValues = [];

                    data.forEach(item => {
                        yValues.push(item.count);
                    })

                    chart.data.datasets.push({
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(0, 85, 255, 1.0)",
                        borderColor: "rgba(0, 85, 255, 0.1)",
                        name: 'New Requests',
                        data: yValues
                    });

                    chart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
            }

            if (document.getElementById('check2').checked) {
                fetch('http://localhost:3000/get_tasks/request/completed/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                .then(response => response.json())
                .then(data => {
                    let yValues = [];

                    data.forEach(item => {
                        yValues.push(item.count);
                    })

                    chart.data.datasets.push({
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(0, 230, 0, 1.0)",
                        borderColor: "rgba(0, 230, 0, 0.1)",
                        name: 'Completed Requests',
                        data: yValues
                    });

                    chart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
            }

            if (document.getElementById('check3').checked) {
                fetch('http://localhost:3000/get_tasks/offer/new/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                .then(response => response.json())
                .then(data => {
                    let yValues = [];

                    data.forEach(item => {
                        yValues.push(item.count);
                    })

                    chart.data.datasets.push({
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(255, 0, 0, 1.0)",
                        borderColor: "rgba(255, 0, 0, 0.1)",
                        name: 'New Offers',
                        data: yValues
                    });

                    chart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
            }

            if (document.getElementById('check4').checked) {
                fetch('http://localhost:3000/get_tasks/offer/completed/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                .then(response => response.json())
                .then(data => {
                    let yValues = [];

                    data.forEach(item => {
                        yValues.push(item.count);
                    })

                    chart.data.datasets.push({
                        fill: false,
                        lineTension: 0,
                        backgroundColor: "rgba(255, 204, 0, 1.0)",
                        borderColor: "rgba(255, 204, 0, 0.1)",
                        name: 'Completed Offers',
                        data: yValues
                    });

                    chart.update();
                })
                .catch(error => console.error('Error fetching data:', error));
            }   

            
            function check1() {
                if (document.getElementById('check1').checked) {
                    fetch('http://localhost:3000/get_tasks/request/new/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                    .then(response => response.json())
                    .then(data => {
                        let yValues = [];

                        data.forEach(item => {
                            yValues.push(item.count);
                        })

                        console.log(yValues);

                        chart.data.datasets.push({
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(0, 85, 255, 1.0)",
                            borderColor: "rgba(0, 85, 255, 0.1)",
                            name: 'New Requests',
                            data: yValues
                        });

                        chart.update();
                    })
                    .catch(error => console.error('Error fetching data:', error));
                }else{
                    for(let i = 0; i < chart.data.datasets.length; i++) {
                        if(chart.data.datasets[i].name == 'New Requests') {
                            chart.data.datasets.splice(i, 1);
                            chart.update();
                            break;
                        }
                    }
                }
            }
            document.getElementById('check1').addEventListener('change', check1);


            function check2() {
                if (document.getElementById('check2').checked) {
                    fetch('http://localhost:3000/get_tasks/request/completed/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                    .then(response => response.json())
                    .then(data => {
                        let yValues = [];

                        data.forEach(item => {
                            yValues.push(item.count);
                        })

                        chart.data.datasets.push({
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(0, 230, 0, 1.0)",
                            borderColor: "rgba(0, 230, 0, 0.1)",
                            name: 'Completed Requests',
                            data: yValues
                        });

                        chart.update();
                    })
                    .catch(error => console.error('Error fetching data:', error));
                }else{
                    for(let i = 0; i < chart.data.datasets.length; i++) {
                        if(chart.data.datasets[i].name == 'Completed Requests') {
                            chart.data.datasets.splice(i, 1);
                            chart.update();
                            break;
                        }
                    }
                }
            }
            document.getElementById('check2').addEventListener('change', check2);


            function check3() {
                if (document.getElementById('check3').checked) {
                    fetch('http://localhost:3000/get_tasks/offer/new/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                    .then(response => response.json())
                    .then(data => {
                        let yValues = [];

                        data.forEach(item => {
                            yValues.push(item.count);
                        })

                        chart.data.datasets.push({
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(255, 0, 0, 1.0)",
                            borderColor: "rgba(255, 0, 0, 0.1)",
                            name: 'New Offers',
                            data: yValues
                        });

                        chart.update();
                    })
                    .catch(error => console.error('Error fetching data:', error));
                }else{
                    for(let i = 0; i < chart.data.datasets.length; i++) {
                        if(chart.data.datasets[i].name == 'New Offers') {
                            chart.data.datasets.splice(i, 1);
                            chart.update();
                            break;
                        }
                    }
                }
            }
            document.getElementById('check3').addEventListener('change', check3);


            function check4() {
                if (document.getElementById('check4').checked) {
                    fetch('http://localhost:3000/get_tasks/offer/completed/' + start_date.toISOString().slice(0, 10) + '/' + end_date.toISOString().slice(0, 10))
                    .then(response => response.json())
                    .then(data => {
                        let yValues = [];

                        data.forEach(item => {
                            yValues.push(item.count);
                        })

                        chart.data.datasets.push({
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(255, 204, 0, 1.0)",
                            borderColor: "rgba(255, 204, 0, 0.1)",
                            name: 'Completed Offers',
                            data: yValues
                        });

                        chart.update();
                    })
                    .catch(error => console.error('Error fetching data:', error));
                }else{
                    for(let i = 0; i < chart.data.datasets.length; i++) {
                        if(chart.data.datasets[i].name == 'Completed Offers') {
                            chart.data.datasets.splice(i, 1);
                            chart.update();
                            break;
                        }
                    }
                }
            }
            document.getElementById('check4').addEventListener('change', check4);
        });

    </script>

</html>